var bookmarks={pageInfo:{isIncognito:!1},getSavedBookmarks:function(a,b){chrome.storage.sync.get(a,function(c){if(chrome.runtime.lastError)return console.error("Unable to retrieve the bookmarks!"),void 0;var d=c[a]||[];b(d)})},saveBookmarks:function(a){chrome.storage.sync.set(a,function(){})},clearAllBookmarks:function(){chrome.storage.sync.clear(function(){console.log("All bookmarks cleared!")})},alertUser:function(a){window.alert(a)},messageListener:function(a,b,c){"openUrl"===a.action?chrome.tabs.create({url:a.url}):"checkIncognito"===a.action&&c(bookmarks.pageInfo.isIncognito)},updateListener:function(a){-1===a&&chrome.tabs.query({currentWindow:!0,active:!0},function(a){a.length>0&&a[0].incognito&&(console.log("Tab is incognito: ",a[0].incognito),bookmarks.pageInfo.isIncognito=a[0].incognito)})},run:function(){chrome.contextMenus.create({title:"Bookmark this page",contexts:["page"],onclick:bookmarks.pages.bookmark}),chrome.contextMenus.create({title:"Bookmark this photo",contexts:["image"],onclick:bookmarks.photos.bookmark}),chrome.contextMenus.create({title:"Bookmark this video",contexts:["video"],onclick:bookmarks.videos.bookmark}),chrome.runtime.onMessage.addListener(bookmarks.messageListener),chrome.tabs.onUpdated.addListener(bookmarks.updateListener),chrome.windows.onFocusChanged.addListener(bookmarks.updateListener)}};bookmarks.pages={createBookmark:function(a,b){var c=window.prompt("Name this page.",b),d={key:c,value:a,isIncognito:bookmarks.pageInfo.isIncognito};return d},bookmark:function(a){chrome.tabs.query({currentWindow:!0,active:!0},function(b){var c=b[0],d=bookmarks.pages.createBookmark(a.pageUrl,c.title);bookmarks.getSavedBookmarks("Pages",function(a){a?(a.push(d),bookmarks.saveBookmarks({Pages:a})):bookmarks.alertUser("Unable to bookmark this page!")})})}},bookmarks.photos={bookmark:function(a){bookmarks.getSavedBookmarks("Photos",function(b){b?(b.push({url:a.srcUrl,isIncognito:bookmarks.pageInfo.isIncognito}),bookmarks.saveBookmarks({Photos:b})):bookmarks.alertUser("Unable to bookmark this photo!")})}},bookmarks.videos={bookmark:function(a){bookmarks.getSavedBookmarks("Videos",function(b){b?(b.push({url:a.srcUrl,isIncognito:bookmarks.pageInfo.isIncognito}),bookmarks.saveBookmarks({Videos:b})):bookmarks.alertUser("Unable to bookmark this video!")})}},window.onload=bookmarks.run;